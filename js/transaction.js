function Transaction({iotaObj, curlObj, sendingSeed, receivingAddress}) {
  const DEPTH = 4;
  const MIN_WEIGHT_MAGNITUDE = 14;

  const getTransactionsToApprove = () => new Promise((resolve, reject) => {
    iotaObj.api.getTransactionsToApprove(4, null, (error, toApprove) => {
      if (error) {
        reject(error);
      } else {
        resolve(toApprove);
      }
    })
  })

  const getInputs = () => new Promise((resolve, reject) => {
    iotaObj.api.getInputs(sendingSeed, (error, result) => {
      if (error) {
        reject(error);
      } else {
        resolve(result.inputs);
      }
    });
  });

  const prepareTransfers = (inputs) => new Promise((resolve, reject) => {
    iotaObj.api.prepareTransfers(
      sendingSeed,
      [{ address: receivingAddress, value: 0 }],
      { inputs },
      (error, result) => {
        if (error) {
          reject(error);
        } else {
          resolve(result);
        }
      }
    );
  });

  return {
    sendTransfer: () => {
      Promise.all([getTransactionsToApprove(), getInputs()])
      .then((toApprove, inputs) => {
        prepareTransfers(inputs)
        .then(transferTrytes => {
          const trxObj = iotaObj.utils.transactionObject(transferTrytes[0]);
          trxObj.trunkTransaction = toApprove.trunkTransaction;
          trxObj.branchTransaction = toApprove.branchTransaction;
          console.log('trxObj', trxObj);
          const transactionTrytes = iotaObj.utils.transactionTrytes(trxObj)
          console.log('transactionTrytes', transactionTrytes);
          curlObj.pow({ trytes: transactionTrytes, minWeight: MIN_WEIGHT_MAGNITUDE})
          .then(nonce => {
            console.log('pow', transactionTrytes.substr(0, 2187 - 81).concat(nonce));
          })
        })
      });
    },
    getTransactionsToApprove,
    getInputs,
    prepareTransfers
  }
};


// const trxObj = {
// 	"hash":"AZMB9QJAOBSFPGRHGFZAKIODTUVRWMRXRPYNGUWEOHBEIMPDJCULQBWLVLPZEBARWKYICVNLKWTWZ9999",
// 	"signatureMessageFragment":"999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
// 	"address":"ILEENLLGPYVWASSAOMNLKOEQVDXSXAWDJTHGUQFVZTPKPZBEGRTNHHIILMCZHZDYAOJIQLU9NYUCITVMD",
// 	"value":0,
// 	"obsoleteTag":"RA9999999999999999999999999",
// 	"timestamp":1514171708,
// 	"currentIndex":0,
// 	"lastIndex":0,
// 	"bundle":"RDOJZDPAWUCFHPYEJJRZOBHOZOLDQPCWWDYOEOEUYLLSHWKXYCKNEDRWVVGWYQXYHLHKRFENCZDKRDCDC",
// 	"trunkTransaction":"AZMVIJUXNW9BAYVZWKVQWDHWBFVJCTKUOURH9DUEV9FYNZEEAJMNKZOKKVEJIAYVASXWPGRZKYDXZ9999",
// 	"branchTransaction":"WO9TFJYR9BGKHTCWWJNPBKYLIYRYSRISMWWQWNNLQHUT99LUNMZUPSCRDVFKLIL9YGWHNAMDGXCT99999",
// 	"tag":"999999999999999999999999999",
// 	"attachmentTimestamp":1514171735237,
// 	"attachmentTimestampLowerBound":0,
// 	"attachmentTimestampUpperBound":3812798742493,
// 	"nonce":"YZ999IM99999999999999999999",
// }